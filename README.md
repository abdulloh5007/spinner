# Lottie Spinner Reel (Next.js)

Интерактивный «спиннер-барабан» для Lottie-анимаций (.tgs/.json). По клику запускается плавный детерминированный спин с глубиной, масштабированием центрального элемента и мягкой физикой. Фоновая палитра плавно переливается между заданными цветами. Отдельная страница настроек позволяет загружать анимации, управлять цветами и настраивать правила выбора результата.

— Подходит для демонстраций ассетов, интерактивов на ивентах, розыгрышей, выбора «победителя» среди анимаций или любых визуальных «рандомайзеров».

## Демонстрация поведения

- Главная: показывает канвас с «барабаном» из 3 видимых ячеек. Клик по канвасу запускает спин с несколькими кругами и гарантированной остановкой по центру.
- Информационная карточка под канвасом синхронно прокручивает название активной анимации и цвет.
- Фон внутри канваса плавно меняет цвет, смешивая соседние тона заданной палитры.

## Возможности

- Загрузка Lottie-анимаций: .tgs (Telegram Sticker, gzip) и .json
- Просмотр и управление загруженными анимациями на странице /settings
- Сохранение локально (localStorage) без сервера:
  - Хранение в компактном формате (data:application/json;base64,...) с обратной совместимостью
  - Тихая обработка переполнения storage: сохранение максимально возможного набора
- Режимы выбора результата спина:
  - Random — равновероятный выбор
  - Fixed — фиксированный индекс анимации/цвета
  - Weighted — взвешенная вероятность для каждой анимации
- Адаптивный канвас с учётом DPR (Retina), масштабирование и блики по краям для глубины
- Плавная смена фона из пользовательской палитры
- UI на чистом React без зависимости от CSS-фреймворков, работает из коробки

## Быстрый старт

Требования: Node.js 18+.

1) Установка зависимостей

```bash
pnpm install
```

2) Запуск разработки

```bash
pnpm run dev
```

Откройте http://localhost:3000

3) Загрузка анимаций и настройка

- Перейдите на http://localhost:3000/settings
- Перетащите или выберите файлы .tgs / .json
- Отредактируйте палитру фона (цвета можно добавлять/удалять и сбрасывать к дефолтной)
- В блоке «Spin outcome preferences» выберите режим:
  - Random / Fixed (с индексом) / Weighted (задать веса для каждой анимации)
- Вернитесь на главную и кликните по канвасу, чтобы запустить спин

Подсказка: если анимации не загружены, используется sample-animation.json из public как пример.

## Как это работает (вкратце)

- src/components/SpinnerReel.tsx:
  - Создаёт «поверхности» Lottie (renderer=canvas), синхронно отрисовывает их в общий канвас
  - Держит 3 видимых слота и рисует ещё по 1 за краями (offscreen) для плавного движения
  - Центральный элемент крупнее соседних (эффект глубины)
  - Фон — одиночный плавно меняющийся цвет, смешиваемый из пользовательской палитры
  - Клик запускает детерминированный сценарный спин с фиксированным числом шагов так, чтобы победитель оказался по центру
- src/app/settings/page.tsx:
  - Драг-н-дроп/выбор файлов .tgs/.json, предпросмотр через lottie-react
  - Редактор палитры фона и режимов выпадения результата (Random/Fixed/Weighted)
  - Все настройки и анимации хранятся в localStorage
- src/lib/tgs.ts:
  - Декодирование .tgs (pako), парсинг .json
  - Безопасное хранение в localStorage (data URL + обработка квоты)
  - Настройки палитры и преференции спина (включая веса) с валидацией

## Технологии

- Next.js 15 (App Router), React 19
- lottie-web (рендер в canvas) и lottie-react (превью в настройках)
- TypeScript, pako

## Структура

- public/sample-animation.json — запасной пример анимации
- src/app/page.tsx — главная страница (канвас + ссылка Settings)
- src/app/settings/page.tsx — загрузка анимаций, палитра, режимы спина
- src/components/SpinnerReel.tsx — ядро визуализации и физики спина
- src/lib/tgs.ts — декодирование/хранение/настройки

## Хранилище и приватность

- Все загруженные анимации и настройки сохраняются в вашем браузере (localStorage). Ничего не отправляется на сервер.
- При переполнении памяти приложение автоматически сохраняет максимально возможное количество элементов, сохраняя устойчивость.

## Скрипты

- dev: next dev --turbopack — запуск режима разработки
- build: next build --turbopack — сборка
- start: next start — запуск production-сборки

## Лицензия

См. LICENSE. Лицензия содержит анти-патентный пункт (патентная не-агрессия и отмена лицензии при патентных исках).
